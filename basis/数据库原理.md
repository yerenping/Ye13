

![image-20211128160724973](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211128165255.png)



# 第一章-数据库基础概念



## 1、信息

信息是客观存在的，是关于现实世界具体事物的存在方式或运动状态的反应的综合

例如：宜春学院的学生	



### 2、数据

数据是信息在计算机里的表示，是信息的具体表现形式

例如：计算机中的一张二维表



### 3、 数据与信息的联系

数据是信息的符号表示或载体

信息则是数据的内涵，对数据的语意解释





## 4、数据库

DataBase：**长期存储**在计算机内，**有组织的**，**可共享的**数据集合。



## 5、数据库管理系统

一种能对数据库进行管理的系统软件，介于用户与OS之间。



## 6、数据库系统

1、数据库

2、数据用户（数据库管理员DBA、普通用户）

3、计算机软件、硬件（数据库管理系统、应用开发系统 、应用系统）

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211128165522.png" alt="image-20211128165522737" style="zoom:50%;" /> 



## 7、数据库系统的体系结构

### （1）三层模式



**1、逻辑模式（1个）**

**2、外模式/子模式(多个外模式)**

**3、内模式（1个）**

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211128170034.png" alt="image-20211128170034920" style="zoom:50%;" /> 



### （2）两级映像

**1、外模式-逻辑模式映像**

有多少个外模式，就有多少个`外模式-逻辑模式映像`

**2、逻辑模式-内模式映像**





<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211128170102.png" alt="image-20211128170102396" style="zoom:50%;" />   



### （3）数据的独立性

定义：**外部的应用程序**和**数据**之间互相独立

①逻辑独立性：DB与应用程序之间的互相独立性

②物理独立性：在DB一改变时，尽量不影响到应用程序





## 8、数据模型

![image-20211128171413770](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211128171413.png) 



> 数据模型的三要素

1、数据结构：用于描述静态特征

2、数据操作：用于描述动态特征

3、数据完整性约束：是一组完整性规则的集合





> 数据模型的分类

1、关系模型

2、半结构化的的数据模型

- 网状数据库
- 层次模型
- XML
- JSON

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211128171649.png" alt="image-20211128171649783" style="zoom:50%;" /> 



## 9、数据库技术的产生和发展

（1）数据管理技术的发展阶段

（2）文件系统管理阶段

（3）数据性系统阶段





# 第二章-关系数据模型



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129153449.png" alt="image-20211129153449535" style="zoom:40%;" /> 

 

**（1）关系数据库系统**

> **关系数据库系统就是支持关系模型的数据库系统**
>
> 1970年IBM公司E.F.Codd提出的关数据模型
>
> 之后又提出：关系代数与关系演算的概念
>
> 1972提出了第一、第二、第三范式



**（2）关系模型的三要数**

1、关系的数据结构——一张二维表

![image-20211128172838751](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211128172838.png)

2、关系的操作

3、关系的完整性约束





## 1、数据结构

一张二维表

![image-20211128172838751](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211128172915.png) 

> 相关概念：

#### ①域

一种具有相同数据类型的值的集合

例如：整数的集合	{男，女} 

性别这一列

![image-20211128173204443](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211128173204.png)  



#### ②笛卡尔积（Cartesian Product）

![image-20211128173330539](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211128173330.png)



![image-20211128173456437](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211128173456.png)



==注：==

==分量：元祖中的一部分==

==元祖：一条信息==

![image-20211128173616129](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211128173616.png)



#### ③关系



![image-20211128173754006](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211128173754.png)

**==元祖（行）：3==**

**==属性（列）：3==**

**==域：表中的每一列对应一个域，故也为3==**



> 码（key，建）

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211128174059.png" alt="image-20211128174059064" style="zoom:33%;" /> 

**1、候选码**

在关系中能够唯一表示元祖的属性或属性集

例如上表中的：属性-学号

**2、主属性**

候选码的各个属性（可能存在多个）

例如**选课表SC(S#,C#,SCORE)**中，候选码为**（S#,C#）** , 主属性为：**S#**与**C#**



**3、主码**

用户选择元祖标识的候选键

==**注：当候选码只有一个的时候，主码 ==候选码 == 主属性**==



**4、全码**

关系中所有的属性都是候选码



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211128175115.png" alt="image-20211128175115012" style="zoom:67%;" /> 

==**问题：这两个关系的候选码是什么呢？**==

The relation Accounts ：acctNo

The relation Customers：idNo + account





#### ④关系模式

关系模式是对关系的描述

关系模式是**型**，关系是**值**

- 关系模式-学生关系

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129143049.png" alt="image-20211129143049113" style="zoom:50%;" /> 





#### ⑤关系数据库

![image-20211129144200932](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129144200.png)



 

## 2、关系操作



![image-20211129144732955](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129144733.png)



## 3、关系的完整性约束

> 定义：关系模型的完整性是指对关系的某种约束条件

**主要有三类：**

1、实体完整性

2、参照完整性

3、用户定义的完整性

**实体完整性**与参照完整性是关系模型必须满足的完整性约束条件



#### ① 实体完整性

1、**主码**唯一，且非空

2、**主属性**不能取空值



==**注：主属性是候选码（主码）的各个属性，主码是由多个主属性组成的**==

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129145512.png" alt="image-20211129145512831" style="zoom:50%;" /> 

 

==在SC成绩表中，主码：SID与CID的组合，主属性：有2个，分别为SID,CID==





 

#### ② 参照完整性

**1、关系间的引用**

![image-20211129150335461](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129150335.png)

![image-20211129150516695](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129150516.png)



2、外码

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129152032.png" alt="image-20211129152032825" style="zoom:67%;" />

3、参照完整性规则（规定外码）



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129152140.png" alt="image-20211129152140457" style="zoom:67%;" />



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129152415.png" alt="image-20211129152415622" style="zoom:67%;" />



#### ③ 用户定义的完整性

![image-20211129152539124](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129152539.png)  



![image-20211129152606207](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129152606.png)









![image-20211129153835133](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129153835.png)



![image-20211129154015856](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129154015.png)



# 第三章-关系代数



> 什么是关系代数？

是一种抽象的数据查询语言

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129154206.png" alt="image-20211129154206572" style="zoom:33%;" /> 

- 运算对象：关系
- 运算符：4类
- 运算结果：关系

 

> 运算法

![image-20211129154429385](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129154429.png) 







### 1、投影



![image-20211129163633480](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129163633.png)

​	

例题 

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129163929.png" alt="image-20211129163929070" style="zoom:67%;" /> 



![image-20211129164038633](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129164038.png)





### 2、选择

![image-20211129164203038](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129164203.png)



例题

![image-20211129164429629](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129164429.png)



![image-20211129164650651](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129164650.png)



![image-20211129164819177](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129164819.png)



其他方式解题

![image-20211129165044971](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129165045.png)



**综合应用**

> 投影+选择解决问题
>
> 操作：一般是先选择，后投影（先行后列）



![image-20211129165236979](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129165343.png)

### 3、笛卡尔积（关系 × 关系）

![image-20211129165626323](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129165626.png)



例题

![image-20211129165729325](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129165729.png)





### 4、连接

![image-20211129165916422](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129165922.png)

等同于↓

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129165841.png" alt="image-20211129165841277" style="zoom:50%;" /> 



**例题：**

![image-20211129170116147](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129170116.png)





#### ① 等值连接

![image-20211129170231066](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129170231.png)



**例题**

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129170342.png" alt="image-20211129170342386" style="zoom:67%;" /> 



例题2（等值连接）



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129171208.png" alt="image-20211129170913876" style="zoom:50%;" /> 



#### ② 自然连接

![image-20211129170450296](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129170450.png)



例题1

![image-20211129171140709](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129171140.png)

==注：自然连接实际上就是在**等值连接**的基础上，去掉**公共属性重复的列**。==





![image-20211129171421127](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129171421.png)



==注：这道题中有两个公共属性，所以必须满足两个公共属性都相等，需要去掉两列。==









#### 综合例子

> 例表

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129171628.png" alt="image-20211129171628610" style="zoom:50%;" /> 



![image-20211129173113999](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129173114.png) 

==**注意：先做连接会影响效率，因此应该先做选择，再做查询**==



![image-20211129173907733](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129173907.png)

**分析：**

1、先选择出名字=LIU的老师（也许只有一个教师LIU）

2、在去跟其他表做自然连接（提升效率）



TID –> CID –> SID –> 学号和姓名，涉及所有表



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129174454.png" alt="image-20211129174454741" style="zoom:67%;" /> 



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129174540.png" alt="image-20211129174540889" style="zoom:67%;" />  

> 正确解法

![image-20211129174929016](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129174929.png)



![image-20211129175209963](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129175210.png)







### 5、重命名

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129175504.png" alt="image-20211129175504516" style="zoom:50%;" />  



> 例子



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129175351.png" alt="image-20211129175351078" style="zoom:30%;" /> 

 





### 6、一些等价的操作

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129175703.png" alt="image-20211129175703748" style="zoom:33%;" /> 





### 7、运算符的优先级

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129175748.png" alt="image-20211129175748086" style="zoom:50%;" /> 

 



### 8、表达式树





![image-20211206083437496](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206083437.png)





![image-20211206083549997](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206083550.png)







![image-20211206083658028](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206083658.png)



# 第四章-SQL语言



> 本章概述



![image-20211206083753647](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206083753.png)





## （1）SQL概述

> SQL概述



![image-20211206083835694](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206083835.png)



> sql标准

![image-20211206083956891](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206083956.png)





> SQL的特点

1. 综合统一

- DDL 数据定义语言
- DML 数据操作语言
- DCL 数据控制语言

2. 高度非过程化

- 用于只需指明“做什么”，而不必指明“怎么做”
- 存取路径的选择及SQL语句的操作过程由系统自动完成

3. 面向集合的操作方式

- 操作对象、查找结果可以是元组的集合
- 一次插入、删除、更新操作的对象可以是元组的集合

4. 同一种语法提供两种使用方式

- 嵌入式
- 自含式

5. 语言简洁，易学易用



> 3大类11个命令词



![image-20211206084630824](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206084630.png)



> SQL支持的三级模式结构



（外模式-视图view、模式-基本表、内模式-存储文件）

![image-20211206084754518](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206084754.png)







> SQL语言的基本概念

![image-20211206090638092](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206090638.png)



## （2）SQL数据定义（DDL）

### 1、Sql数据定义功能

![image-20211206090823427](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206090823.png)



### 2、定义、删除与修改基本表

![image-20211206091002972](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206091003.png)



#### ①、定义基本表

> 定义基本表



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206091241.png" alt="image-20211206091241597" style="zoom:50%;" /> 



> 定义表的基本格式

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206091316.png" alt="image-20211206091316314" style="zoom:50%;" /> 



`char`：固定长度字符  

例如char(8)，如果只使用了7字符，第8个字符系统会留着

`varchar`：可表长度字符

例如char(20)，如果只使用了2字符，后18个字符系统会分配给其它变量用



> 表级完整性约束及列级完整性约束

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206092842.png" alt="image-20211206092842602" style="zoom:50%;" /> 



> SQL支持的数据类型

**第一大类：==整数==数据**

![image-20211206092922382](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206092922.png)



**第二大类：==精确数值==数据**

![image-20211206093135346](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206093135.png) 



**第三大类：==浮点==数值数据**

![image-20211206094004747](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206094004.png)



**第四大类：==字符串==数据**

![image-20211206094042269](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206094042.png) 



**第五大类：==日期时间==数据**

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206094153.png" alt="image-20211206094153385" style="zoom:50%;" /> 



> 例题



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206121455.png" alt="image-20211206121455408" style="zoom:50%;" /> 

==注意：primary key 与unique的区别==

==1、一个表必须有主键，而且仅能有一个主键，而unique可以定义多个==

==2、主键不能为空，而unique可以为空==



> 例题2



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206130626.png" alt="image-20211206130626169" style="zoom:50%;" /> 

==注：标记完整性约束的方式进行定义-`primary key(sno,cno)`==



#### ②、修改基本表

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206133809.png" alt="image-20211206133809079" style="zoom:50%;" /> 



![image-20211206133846850](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206133846.png)



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206133959.png" alt="image-20211206133959872" style="zoom:50%;" /> 









#### ③、删除基本表

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206134207.png" alt="image-20211206134207655" style="zoom:50%;" /> 





## （3）SELECT查询语句（DML）

> 查询语句格式

 

![image-20211206141428840](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206141428.png)



> 示例数据库

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206141532.png" alt="image-20211206141532253" style="zoom:50%;" /> 



### 1、单表查询

![image-20211206183627635](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206183627.png)



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206141720.png" alt="image-20211206141720882" style="zoom:50%;" /> 



#### ①、选择表当中的若干列

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206141908.png" alt="image-20211206141908251" style="zoom:33%;" /> 



> 查询指定的列

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206141941.png" alt="image-20211206141941537" style="zoom:50%;" /> 



> 例题

![image-20211206142217633](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206142217.png) 



```sql


1、查询全体学生的学号与姓名


select sno,sname from Student;




2、全体学生的姓名、学号、所在系


select sno,sname,dept from Stduent;




3、查询全体学生的姓名及出生年份


select sname,year(getdate()) as '出生年月' from student; // A as B 给A取别名为B




4、查询全体学生的姓名，出生年份和所在系，要求用小写字母表示所有名称

select sname NAME,year(getdate()) as 'BIRTH' lower(Sdept) DEPARTMENT from student; // lower 大写->小写



```





<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206142850.png" alt="image-20211206142850823" style="zoom:50%;" /> 



#### ②、选择表中若干元组



```sql
1、查询选修了课程的学生学号
select sno from student; // 查询结果会有重复

-- 改进 --
select distinct sno from student; // distinct 去重复

```



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206144451.png" alt="image-20211206144451474" style="zoom:33%;" /> 



> 查询满足条件的元祖

![image-20211206144556662](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206144556.png)



##### 1. 比较大小

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206144651.png" alt="image-20211206144651244" style="zoom: 33%;" /> 





<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206144736.png" alt="image-20211206144736588" style="zoom:50%;" /> 





<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206144806.png" alt="image-20211206144806302" style="zoom:33%;" /> 





##### **2. 确定范围**

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206145441.png" alt="image-20211206145441141" style="zoom:33%;" /> 



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206145624.png" alt="image-20211206145608354" style="zoom:50%;" /> 





##### **3. 确定集合**

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206145719.png" alt="image-20211206145719714" style="zoom:50%;" /> 

例题

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206145746.png" alt="image-20211206145746138" style="zoom:50%;" /> 

或者

```sql
select * from sname,sex from stdudent
where sdept = 'is' or sdept = 'ma' or sdept= 'cs';
```





<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206145819.png" alt="image-20211206145819079" style="zoom:50%;" />



或者

```sql
select * from sname,sex from stdudent
where sdept != 'is' and sdept != 'ma' and sdept != 'cs';
```





##### 4. 字符串匹配运算法

![image-20211206150102063](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206150102.png)







![image-20211206150155784](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206150155.png)



**通配符**

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206150222.png" alt="image-20211206150221950" style="zoom:50%;" />



**%号：多个字符**

![image-20211206150255410](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206150255.png)



**“_”单个字符**



![image-20211206150338996](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206150339.png)



![image-20211206150515833](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206150515.png)



![image-20211206150607918](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206150608.png)



##### 5. 涉及空值的查询

![image-20211206150810223](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206150810.png)





<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206151056.png" alt="image-20211206151056125" style="zoom:50%;" />



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206151119.png" alt="image-20211206151119071" style="zoom:50%;" /> 





##### 6.多重条件查询

![image-20211206151210929](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206151211.png)



1、查询信息系（IS）,数学系（MA）和计算机科学系（CS）的学生学号与性别

```sql
select * from sname,sex from stdudent
where sdept = 'is' or sdept = 'ma' or sdept= 'cs';

select * from sname,sex from stdudent
where sdept in ('is','ma','cs'); // 等价于上面的方式
```



#### ③、对查询结果进行排序

![image-20211206151547326](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206151547.png)



例题：

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206151633.png" alt="image-20211206151633467" style="zoom:50%;" /> 



![image-20211206151737860](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206151737.png) 



#### ④、使用集函数

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206151809.png" alt="image-20211206151809491" style="zoom:33%;" /> 

==注：==
==1、上述集函数不会统计null值==

==2、count(*) 统计行数==

==3、列名前面都能加distinct，则统计去掉重复行==



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206171425.png" alt="image-20211206171424952" style="zoom:50%;" /> 



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206171524.png" alt="image-20211206171524088" style="zoom:50%;" /> 



#### ⑤、对查询结果分组



##### 1、GROUP BY

![image-20211206171616990](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206171617.png)



> 求各个课程号及相应的选课人数

```sql
select cno,count(sno) from score by cno
```

> 统计一下各个课程的选修人数以及各个课程的最高分

```sql
select cno,count(sno),max(grade) from score group by cno
```

==-- 分析语句 --==
==1、先执行group by cno,安装课程号进行分组==
==2、分组之后的每一组应用count、max等聚合函数==



**==注意：==**

**==当一个select语句中含有group by子句的话，select语句中只能包含两种情况：==**

**==（1）、group by后面的列名==**

**==（2）、聚合函数==**





例题：

> 求各个课程号及相应的课程成绩在90分以上的学生人数

```sql
-- 分析 --
1、求各个课程号
2、课程成绩在90分以上的人数

select cno count(sno) from score 
where grade>=90
group by cno
```



> 系统内部执行的顺序

![image-20211206181959777](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206181959.png)



##### 2、HAVING



![image-20211206182133203](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206182133.png)



![image-20211206182153450](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206182153.png)



![image-20211206182352482](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206182352.png)



**==注意：==**

**==HAVING 后面可以跟列名，也可以跟聚合函数==**

**==WHERE 后面不可以跟聚合函数，可以跟列名==**



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206182730.png" alt="image-20211206182730776" style="zoom:50%;" /> 



### 2、连接查询（多表查询）

#### （1）交叉连接（广义笛卡尔积）

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207112414.png" alt="image-20211207112414061" style="zoom: 50%;" /> 

 



#### （2）等值连接

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207112524.png" alt="image-20211207112524556" style="zoom:50%;" /> 



![image-20211207112900883](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207112901.png)



#### （3）自连接

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207113020.png" alt="image-20211207113020229" style="zoom:50%;" /> 



> 1、查询每一门课的直接先修课的课程名

```sql
select c1.Cname c2.Cname from course c1,course c2
where c1.Cpno = c2.Cno
-- 执行顺序 -- 
1、先执行form
2、后执行where字句
3、在执行select字句
```



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207113611.png" alt="image-20211207113610986" style="zoom:50%;" />



> 查询每门课的间接先修课的课程号（即先修课的先修课）

```shell
select c1.Cname c2.Cpno from course c1,course c2
where c1.Cpno = c2.Cno
-- 执行顺序 -- 
1、先执行form
2、后执行where字句
3、在执行select字句
```



![image-20211207113919314](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207113919.png)



> 查询同时选修2号课程和3号课程学生的学号

```sql
select c1.sno from Course c1, Course c2
where c1.sno = c2.sno
and c1.cno<>n.cno -- 去重复 --
add c1.cno=2 and c2.cno=3  -- 满足同时选修2号和3号课程 --
```





![image-20211207120444746](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207120444.png)



#### （4）复合连接

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207121627.png" alt="image-20211207121626867" style="zoom:50%;" /> 

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207121740.png" alt="image-20211207121740796" style="zoom:50%;" /> 



#### （5）内连接

![image-20211207122223637](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207122223.png)





#### （6）外连接

![image-20211207122255905](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207122256.png)

> 左连接



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207122526.png" alt="image-20211207122526570" style="zoom:50%;" /> 



> 右连接



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207122603.png" alt="image-20211207122603494" style="zoom:50%;" /> 



> 全连接

![image-20211207122642005](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207122642.png)







### 3、嵌套查询

> 相关子查询



![image-20211207125410116](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207125410.png)



> 不相关子查询



![image-20211207125508461](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207125508.png)



> 子查询的限制



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207130228.png" alt="image-20211207130227869" style="zoom:50%;" /> 





> 嵌套查询的谓词

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207130409.png" alt="image-20211207130409482" style="zoom:50%;" /> 





##### **（1）带IN谓词的子查询**



![image-20211207130519600](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207130519.png)

改进

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207130638.png" alt="image-20211207130638089" style="zoom:50%;" /> 





<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207130730.png" alt="image-20211207130730239" style="zoom: 33%;" /> 



#####  （2）带有比较运算符的子查询

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207130914.png" alt="image-20211207130914086" style="zoom:50%;" /> 





<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207131344.png" alt="image-20211207131344805" style="zoom:50%;" /> 





##### （3）带有ANY或ALL谓词的子查询

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207164414.png" alt="image-20211207164413845" style="zoom:50%;" /> 





![image-20211207164508348](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207164508.png)





##### （4）带有EXSIST谓词的子查询

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207165802.png" alt="image-20211207165802020" style="zoom:50%;" /> 





<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207170008.png" alt="image-20211207170008796" style="zoom:50%;" /> 



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207170116.png" alt="image-20211207170115968" style="zoom:50%;" /> 



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207170159.png" alt="image-20211207170159289" style="zoom:50%;" /> 



### 4、集合查询

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207170238.png" alt="image-20211207170238491" style="zoom:50%;" /> 



##### （1）并操作-UNION



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207170333.png" alt="image-20211207170333654" style="zoom:50%;" /> 



#####  （2）交操作



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207170452.png" alt="image-20211207170451849" style="zoom:50%;" /> 



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207170544.png" alt="image-20211207170544425" style="zoom:50%;" /> 





##### （3）查操作

![image-20211207170659987](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207170700.png) 



##### （4）对集合操作的结果的排序

![image-20211207170746648](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207170746.png)



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207170805.png" alt="image-20211207170804899" style="zoom:50%;" /> 



## （4）数据更新（DML）

> insert
>
> update
>
> delete



> 示例数据库



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207171038.png" alt="image-20211207171037845" style="zoom:50%;" /> 





### 1、插入数据

> 插入单个元组

![image-20211207171927435](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207171927.png) 



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207172111.png" alt="image-20211207172111463" style="zoom:50%;" /> 



> 插入子查询结果



![image-20211207172349540](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207172349.png)



> 完整性校验



![image-20211207172501686](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207172501.png)





### 2、修改数据

![image-20211207173509465](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207173509.png) 



> 修改一个元组的值



![image-20211207174057358](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207174057.png)







> 修改多个元组的值





![image-20211207174137707](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207174137.png)



![image-20211207174147945](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207174148.png)





> 带子查询的修改语句

**采用不相关子查询的方式**

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207174239.png" alt="image-20211207174239021" style="zoom:50%;" />

**采用相关子查询方式解题**

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207174442.png" alt="image-20211207174442560" style="zoom:50%;" />



### 3、删除数据

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207174625.png" alt="image-20211207174606177" style="zoom:50%;" /> 

 



> 1、删除一个元组的值



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207175127.png" alt="image-20211207175126801" style="zoom:33%;" /> 



 





> 2、删除多个元组的值



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207175143.png" alt="image-20211207175143358" style="zoom:33%;" /> 



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207175202.png" alt="image-20211207175202472" style="zoom:33%;" /> 





> 3、带子查询的删除语句



方式1：不好理解

![image-20211207175327235](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207175327.png)



方式2：好理解

![image-20211207175343288](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207175343.png)





> 完整性校验



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207174930.png" alt="image-20211207174930195" style="zoom:50%;" /> 



**==补充：==**

==delete from sc ：一行一行删  		—DML==

==truncate table sc ：速度快，表删 	—DDL==

```sql
truncate table sc; 隐含下面两条命令
drop table sc;
create table sc;
```





## （5）视图

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207180326.png" alt="image-20211207180325808" style="zoom:67%;" /> 



> 视图的特点



![image-20211207180432411](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207180432.png)

> 视图的基本操作



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207180526.png" alt="image-20211207180526049" style="zoom:50%;" /> 



### 1、创建视图

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207180629.png" alt="image-20211207180629691" style="zoom:50%;" />  



![image-20211207180735021](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207180735.png)



> 建立视图



![image-20211207181037028](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207181037.png)





 



#### ① 行列子集视图



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208092921.png" alt="image-20211208092921570" style="zoom:50%;" /> 









#### ②WUTH CHICK OPTION视图

![image-20211208093201394](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208093215.png)



注：可以通过视频图操作对表进行更新

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208093332.png" alt="image-20211208093332838" style="zoom:50%;" /> 

 

 





#### ③ 基于多个基本表的视图



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208093536.png" alt="image-20211208093536327" style="zoom:50%;" />

#### ④ 基于视图的视图

![image-20211208093650306](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208093703.png)



#### ⑤ 带表达式的视图

![image-20211208093838160](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208093838.png) 

这题中含有表达式：`2018-Sage`

#### ⑥ 分组视图

![image-20211208094037170](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208094037.png)



> 用全名列名替代*



![image-20211208094248108](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208094248.png)





### 2、删除视图

![image-20211208120332755](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208120332.png)



![image-20211208120431900](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208120432.png)



### 3、视图的查询方法

#### （1）视图实例化法

![image-20211208120523980](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208120524.png)

![image-20211208120726942](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208120727.png)

####  （2）视图消解法



![image-20211208120535761](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208120535.png)





![image-20211208134206899](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208134207.png)





![image-20211208134228672](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208134228.png)







### 4、更新视图

![image-20211208134315734](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208134315.png)





> updata：实际上是对基本表进行操作

![image-20211208134556309](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208134556.png)

> insert实际上也是对基本表进行操作



![image-20211208134627303](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208134627.png)



![image-20211208134705313](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208134705.png)





> DBMS对视图更新的限制



![image-20211208134908566](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208134908.png)

> 视图的

![image-20211208134946141](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208134946.png)



**行列子集视图：**==from后面只有一个表，只取自于单个表的，而且这个视图要包含原表的主键==





### 5、视图的作用

![image-20211208140045929](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208140133.png)



![image-20211208140127347](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208140127.png)



## （6）索引

### 1、建立索引

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208143150.png" alt="image-20211208143150424" style="zoom:50%;" /> 

 

![image-20211208143316377](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208143316.png)



> 唯一值索引

![image-20211208143338133](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208143338.png)



![image-20211208143510135](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208143510.png)



> 聚簇索引-主键列

在建表的时候，会自动给主键添加聚簇索引







> 普通索引：非unique，非聚簇索引



### 2、删除索引

![image-20211208145611383](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208145611.png)



## （7）数据控制语言（DCL）

![image-20211208145913206](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208145913.png)



![image-20211208150110409](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208150110.png)



## （8）嵌入式SQL

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208150524.png" alt="image-20211208150523888" style="zoom:33%;" /> 











# 第五章-数据库设计（ER模型/UML模型）

> 数据库设计的步骤
>
> 数据库设计工具
>
> ER图
>
> UML图



![image-20211208151109420](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208151109.png)



## 1、数据库设计的过程

![image-20211208151551079](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208151551.png)





<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208151714.png" alt="image-20211208151714379" style="zoom:33%;" /> 





> 问题的提出

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208152023.png" alt="image-20211208152023436" style="zoom:33%;" /> 





### 1.1 规划

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208152059.png" alt="image-20211208152059184" style="zoom:33%;" /> 

 

### 1.2 需求分析

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208152615.png" alt="image-20211208152615532" style="zoom:33%;" /> 

### 1.3 概念设计

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208152706.png" alt="image-20211208152706510" style="zoom:33%;" /> 





> 概念设计的主要步骤

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208152736.png" alt="image-20211208152736135" style="zoom: 33%;" /> 



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208152756.png" alt="image-20211208152756732" style="zoom:33%;" /> 



### 1.4 逻辑设计阶段

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208152851.png" alt="image-20211208152851067" style="zoom:33%;" /> 





> 逻辑设计的步骤



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208152916.png" alt="image-20211208152916716" style="zoom:50%;" /> 



### 1.5 物理设计阶段

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208153002.png" alt="image-20211208153002165" style="zoom:67%;" /> 

### 1.6 数据库的实现

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208153034.png" alt="image-20211208153033847" style="zoom:33%;" /> 

### 1.7 数据库的运行与维护

![image-20211208153113926](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208153114.png)





> 小结



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208153154.png" alt="image-20211208153153969" style="zoom: 33%;" /> 

 

 	<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208153226.png" alt="image-20211208153226464" style="zoom: 33%;" /> 

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208153303.png" alt="image-20211208153302896" style="zoom:50%;" /> 

 



## 2、概念设计工具

### （1）ER模型

> 实体联系模型



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208153610.png" alt="image-20211208153609882" style="zoom:50%;" /> 

#### 1、ER模型的基本元素

##### ① 实体

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208153857.png" alt="image-20211208153857756" style="zoom:50%;" /> 



![image-20211208153919098](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208153919.png)



##### ② 属性

![image-20211208154002780](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208154002.png)



![image-20211208154104885](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208154105.png)



![image-20211208154246800](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208154246.png)

> 实体与属性的区别





![image-20211208155356370](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208155356.png)



##### ③ 联系



![image-20211208155531938](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208155532.png)

注：上方为2元联系



![image-20211208155557439](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208155610.png)



![image-20211208155633962](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208155634.png)



#### 2、联系的类型

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208155656.png" alt="image-20211208155656030" style="zoom:50%;" /> 





**以下为二元联系的类型**



> 1对1



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208155811.png" alt="image-20211208155811209" style="zoom:50%;" /> 



> 1对多

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208155905.png" alt="image-20211208155905490" style="zoom:50%;" /> 



> 多对多

![image-20211208160012527](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208160012.png)





**以下为一元联系**

> 1对1

![image-20211208160349103](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208160349.png)

==运动员的出场顺序：一个运动员前面只有一个运动员，后面也只有一颗运动员==



> 1对多

![image-20211208160551441](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208160551.png)

==**职工：一个职工组织中只有一个领到，一个职工可以领到很多其他的职工，其他的很多职工只受这一个职工的领到**==





![image-20211208160704568](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208160704.png)

==**零件：一个零件可以由很多小零件组成，一个小零件可以组成其他很多大零件**==



**三元联系**

![image-20211208161018658](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208161018.png)



#### 3、设计ER模型（概念模型）



##### ① 设计局部的ER模型

![image-20211208161451152](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208161451.png)





![image-20211208161556264](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208161556.png)



> 实例



![image-20211208161647237](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208161647.png)





![image-20211208162016969](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208162017.png)





![image-20211208162306425](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208162306.png)



![image-20211208162507859](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208162508.png)



![image-20211208162607899](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208162608.png)



![image-20211208162629514](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208162629.png)



##### ② 设计全局的ER模型



![image-20211208162912159](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208162912.png)



> 整个教务管理系统

![image-20211208162939903](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208162940.png)







#### 3、将ER模型转换成关系数据库支持的关系模型

> 第一步 - 实体类型的转换



![image-20211208163254622](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208163254.png)



> 第二步-联系类型的转换

![image-20211208164710924](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208164711.png)



例题：

![image-20211208163528821](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208163529.png)



**第一步：每个实体转换成一个关系模式**



![image-20211208163551227](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208163551.png)



第二步：联系类型的转换

![image-20211208165019735](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208165019.png)







> 例题

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208184436.png" alt="image-20211208184436341" style="zoom:50%;" /> 



1、根据信息 画ER图

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208184117.png" alt="image-20211208184117329" style="zoom:67%;" /> 





2、将ER图转换成关系模式

![image-20211208184139132](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208184139.png)



### （2）UML模型

![image-20211208185816594](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208185816.png)

#### 1、定义

> UML是一种感念模型
>
> Unified Modeling Language  统一建模语言



![image-20211208185651351](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208185651.png)



#### 2、UML与E/R 术语对比

![image-20211208190159423](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211208190159.png)







#### 3、UML类

![image-20211209153823851](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209153824.png)



![image-20211209153903878](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209153904.png)



> 例子

酒吧类（Bar Class）

![image-20211209153924131](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209153924.png)



#### 4、关联



![image-20211209154149876](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209160337.png)



>  例子

![image-20211209160645793](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209160645.png)





> 实例-将Movide数据库设计E/R图

![image-20211209160910804](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209160911.png)



> 用UML图表示Movie数据库



![image-20211209161128428](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209161128.png)

 

![image-20211209161300725](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209161300.png)



**关联类**

![image-20211209161324754](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209161324.png)



![image-20211209161407120](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209161407.png)



> 例子

![image-20211209161515986](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209161516.png)



> 自身关联



![image-20211209161556866](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209183033.png)



#### 5、子类



![image-20211209161702052](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209161702.png)



> 子类的四种类型

![image-20211209161828736](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209161828.png)



![image-20211209162049834](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209162050.png)



> 例子



![image-20211209162207139](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209162207.png)



#### 6、聚集（Aggregations）

![image-20211209162538255](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209162645.png)





#### 7、组成（compositions）

![image-20211209162715898](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209162821.png)









> 例题

![image-20211209163735169](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209163735.png)



**转化成UML图**

![image-20211209163951789](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209163952.png)



#### 8 、UML转化为关系模式

![image-20211209164219819](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209183034.png)



> 例题

![image-20211209164159847](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209164200.png)

> 例题2



![image-20211209164454345](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209164454.png)





#### 9、UML子类转化为关系

![image-20211209164608838](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209164609.png)



> 例题





![image-20211209164742262](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209164742.png)

> 根据说明画图ER模型



![image-20211209164911923](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209164912.png)

> 将ER模型转化成UML，再将UML转关系模式



![image-20211209165024343](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209165024.png)









# 第六章-数据库规范化理论



## 1、函数依赖







## 2、范式







## 2、关系规范化









# 第七章- 数据库管理

> 章节脑图



![image-20211202183005397](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202183005.png)



## 1、安全性



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211130103417.png" alt="image-20211130103417087" style="zoom:50%;" /> 



==**用户非法使用数据库的情况**==

![image-20211130103535099](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211130103535.png)



> 计算机系统中常用的安全模型



![image-20211130103631578](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211130103631.png)



### 1.1 安全性控制的一般方法

> （1）用户标识和鉴定 （应用程序）
>
> 比如：qq登录，需要用户名和密码
>
> （2）存取控制 
>
> （3）视图（DBMS）
>
> （4）审计（DBMS）
>
> （5）密码存储 (DB)



#### （1）用户标识和鉴定	

![image-20211209093231814](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209093231.png)





> 用户表示与鉴定的基本方法

![image-20211209093331193](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209093331.png)

![image-20211209093353846](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209093354.png)



#### （2）存取控制

> DBMS

![image-20211209093452825](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209093452.png)



> 存取控制机制的组成

![image-20211209093518344](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209093518.png)



> 定义存取权限



![image-20211209093553190](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209093553.png)



![image-20211209093609076](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209093609.png)





![image-20211209093716972](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209093717.png)



> 检查存储权限

![image-20211209093757736](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209093757.png)

> 数据对象授权的粒度

![image-20211209093826821](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209093826.png)





<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209093922.png" alt="image-20211209093922560" style="zoom:50%;" /> 





![image-20211209094011984](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209094012.png)





#### （3）定义视图

![image-20211209094104159](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209094104.png)

![image-20211209094119591](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209094119.png)

> 例题



![image-20211209094203148](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209094203.png)



#### （4）审计

![image-20211209094244418](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209094244.png)



==安全级别：D C1 C2 D1 D2 D3 A1== （A1最高）



![image-20211209094405197](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209094405.png)





####  （5）数据加密

![image-20211209121940916](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209121941.png)



![image-20211209122018128](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209122018.png)



















### 1.2 SQL的DCL实现存取权限管理



![image-20211202085246383](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202085246.png) 



> SQL的DCL实现存取权限管理
>
> 授权
>
> 回收权利







![image-20211209122129587](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209122129.png)





#### 一、SQL授权功能



![image-20211209122231740](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209122231.png)





**1. 操作权限**

![image-20211209170635325](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209170635.png)



**2. 用户的权限**

![image-20211209171128459](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209171128.png)



3. **接受权限的用户**

![image-20211209171159474](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209171159.png)

3.  **WITH GRANT OPTION**

![image-20211209171212540](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209171212.png)





> 例题1：一次向一个用户授予权限

![image-20211209171419936](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209171420.png)



> 例题2：一次向多个用户授予权限

![image-20211209171429661](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209171429.png)



> 把SC表的SELECT查询权限授予所有用户

![image-20211209171629391](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209171629.png)



> 一次授予两种权限给一个用户

![image-20211209171652940](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209171653.png)





> with grant otion

![image-20211209171754890](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209171755.png)



> U5把权限授予U6

![image-20211209171837492](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209171837.png)





> 建表CREATE 权限的授予

![image-20211209171939945](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209171940.png)



#### 二、SQL回收权限功能

> revoke



![image-20211209172119313](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209172119.png)



![image-20211209172142500](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209172142.png)



![image-20211209172154229](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209172154.png)



![image-20211209172226394](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209172226.png)





## 2、完整性

### （1）完整性约束条件

### （2）完整性控制

### （3）SQL Server 完整性实现

## 3、并发控制



![image-20211202085648549](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202085648.png)



#### 3.1 并发控制概述

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202085805.png" alt="image-20211202085805226" style="zoom:50%;" /> 



==**事务**==是并发控制和恢复的基本单位



##### **（1）、事务**

![image-20211202090008710](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202090008.png)



> 事务的定义

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202090059.png" alt="image-20211202090059386" style="zoom:50%;" /> 



> 事务的两种定义方式

![image-20211202090142471](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202090142.png)



**事务的显示定义**

![image-20211202090222749](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202090222.png)



> COMMIT 与ROLLBACK



![image-20211202090256823](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202090256.png)



> 事务的四个特性



![image-20211202090359288](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202090359.png)



- **原子性**

![image-20211202090439542](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202090439.png)

- **一致性**

![image-20211202090536428](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202090536.png)



![image-20211202090624431](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202090624.png)



- **隔离性**

![image-20211202091336734](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202091336.png)



- **持久性**

![image-20211202091354721](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202091354.png)



> 破坏事务的特性

![image-20211202091515754](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202091515.png)





> 多事务执行方式



![image-20211202091622589](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202091622.png)





> 事务并发执行带来的问题

![image-20211202091726659](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202091726.png)





##### （2）、数据的不一致性问题

###### 1、丢失修改

![image-20211202091924137](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202091924.png)



###### 2、不可重复度

- **读-更新**

![image-20211202092241873](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202092241.png)

![image-20211202092148071](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202092148.png)

- **读-删除**

![image-20211202092258949](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202092259.png)



- **读-插入**

![image-20211202092320125](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202092320.png)



注：第二种与第三种现象也称为`幻行现象`





###### 3、读脏数据

![image-20211202092440170](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202092440.png)



#### 3.2 并发操作的调度

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202092603.png" alt="image-20211202092603168" style="zoom:33%;" /> 





<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202092633.png" alt="image-20211202092632947" style="zoom:33%;" /> 





<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202092731.png" alt="image-20211202092731702" style="zoom:33%;" /> 





> a、串行调度策略 -正确



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202092747.png" alt="image-20211202092747102" style="zoom:33%;" /> 





> B、串行调度策略 -正确

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202092848.png" alt="image-20211202092848873" style="zoom: 33%;" /> 





> c、不可串行

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207164443.png" alt="image-20211202144215919" style="zoom:33%;" /> 



 

#### 3.3 封锁

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202150418.png" alt="image-20211202150418561" style="zoom:53%;" /> 



> 封锁的定义



![image-20211202150537114](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202150537.png)

##### 3.1.1 封锁的类型

###### 1、排它锁（eXclusive lock，简称X锁，写锁）

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207164444.png" alt="image-20211202150959806" style="zoom:50%;" /> 













###### 2、共享锁（Share lock，简称S锁，读锁）



![image-20211202151336866](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202151336.png)



###### 3、封锁类型的相容性

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202151445.png" alt="image-20211202151445794" style="zoom:50%;" /> 



###### 4、封锁的粒度

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202151545.png" alt="image-20211202151545848" style="zoom:67%;" /> 



![image-20211202151609331](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202151609.png)



![image-20211202151653823](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202151653.png)



> 封锁的一般原则

![image-20211202151736086](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202151736.png)

 



###### 5、封锁协议

![image-20211202151823229](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202151823.png)





###### 6、三级封锁协议



**一级封锁协议：**

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211207164445.png" alt="image-20211202152004830" style="zoom:50%;" /> 

==注：一级封锁协议只规定了写（更新）之前要加X锁，并没有规定读之前要加锁==





> 一级封锁： 解决了丢失更新问题

![image-20211202152339259](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202152339.png) 







> 一级封锁： 没能解决“读脏数据”问题

![image-20211202152624561](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202152717.png)



> 一级封锁： 没能解决 不可重复读问题

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202152922.png" alt="image-20211202152922836" style="zoom:50%;" /> 





**二级封锁协议：**

![image-20211202153350025](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202153350.png)



> 二级封锁协议-解决–“不读脏数据问题”

![image-20211202153526642](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202153526.png)





> 二级封锁协议-不能解决–“不可重复读问题”

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202154027.png" alt="image-20211202154027734" style="zoom:50%;" /> 



**三级封锁协议：**

![image-20211202175545389](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202175609.png)



> 三级封锁协议-解决了不可重复度的问题

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202175937.png" alt="image-20211202175937018" style="zoom:67%;" /> 



> 三级封锁协议总结

![image-20211202180208424](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202180208.png)





###### 7、两段锁协议

![image-20211202181113320](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202181113.png)





> 例子

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202181245.png" alt="image-20211202181245293" style="zoom:50%;" /> 



![image-20211202181443562](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202181443.png) 







#### 3.4 活锁

![image-20211202182019728](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202182019.png)



> 如何避免活锁

![image-20211202182132076](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202182132.png)





#### 3.5 死锁

![image-20211202182207284](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202182207.png)



> 解决死锁方法



**1、死锁的预防**

![image-20211202182332404](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202182332.png)



![image-20211202182525903](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202182525.png)



![image-20211202182545359](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202182545.png)



> 循序封锁法存在的问题



![image-20211202182600697](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202182600.png)





**2、死锁的诊断与解除**

![image-20211202182654381](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202182654.png)



![image-20211202182920979](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202182921.png)







##   4、 数据库的故障与恢复

![image-20211209172541809](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209172542.png)



> 数据库的可恢复性

![image-20211209172645396](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209172645.png)



#### 1、数据库故障的3种类型

##### ① 事务故障

![image-20211209172801915](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209172802.png)



##### ② 系统故障（内存）



![image-20211209172900133](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209172900.png)



> 系统故障的原因

![image-20211209172912562](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209172912.png)



##### ③ 介质故障（磁盘损毁）

![image-20211209172956102](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209172956.png)



> 各种故障小结



![image-20211209175641917](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209175642.png)



#### 2、故障恢复实现技术

![image-20211209175743027](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209175743.png)



##### （1）数据转储

> 复制一个备份到另一个设备中，解决介质故障问题



![image-20211209180401685](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209180401.png)



> t1->t2时刻，数据转储成功！
>
> 若当事务在t3发生故障时，通过转储操作，可以将数据恢复至t2，在重新运行事务，即可恢复到t3状态



![image-20211209180534354](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209180534.png)

######  ① 静态转储（停服务器）

![image-20211209180846535](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209180846.png)



> 静态转储缺点

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209180918.png" alt="image-20211209180918156" style="zoom:50%;" /> 





> 利用静态转储进行数据恢复

![image-20211209181005727](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209181005.png)





###### ② 动态转储（无需停用服务器）

![image-20211209181022944](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209181023.png)



![image-20211209181228862](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209181229.png)





###### ③ 海量转储

> 每次转储全部数据库



###### ④ 增量转储

> 每次只转储上一次转储后更新过的数据



> 海量转储与增量转储的比较

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209181605.png" alt="image-20211209181605148" style="zoom:50%;" /> 



###### ⑤ 数据转储方法分类

![image-20211209181657045](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209181657.png)



> 转储的策略

![image-20211209181729733](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209181729.png)





##### （2）日志文件

![image-20211209181827583](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209181827.png)



![image-20211209181915568](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209181915.png)



![image-20211209181931219](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209181931.png)

![image-20211209181942503](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209181942.png)



###### 1、日志文件的用途

![image-20211209182019988](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209182020.png)



##### （3）静态存储后备副本配合进行介质故障恢复



![image-20211209182054244](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209182054.png)



![image-20211209182211533](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209182211.png)



##### （4）与动态存储后备副本配合使用进行介质故障的恢复

![image-20211209182448945](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209182449.png)





> 登记日志文件的原则

![image-20211209182603414](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209182603.png)



#### 3、规章恢复策略

##### （1）事务故障的恢复

![image-20211209182749284](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209182749.png)

> 恢复步骤

![image-20211209182813805](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209182814.png)





##### （2）系统故障的恢复

![image-20211209182857622](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209183035.png)





> 恢复步骤

![image-20211209182925621](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209182925.png)



##### （3）介质故障的恢复

![image-20211209183023429](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209183023.png)



> DBA帮助恢复介质故障



![image-20211209183156305](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209183156.png)



> 小结

![image-20211209183231670](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209183231.png)



![image-20211209183247130](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209183247.png)



![image-20211209183340805](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209183340.png)





## 5、数据库复制

### （1）数据库复制

![image-20211209183927711](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209183928.png)





![image-20211209185221443](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209185534.png)



#### 1、对等复制

![image-20211209185543725](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209185544.png)

#### 2、主/从复制

![image-20211209185625056](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209185625.png)



#### 3、级联复制

![image-20211209185643238](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209185643.png)





> DBMS在使用复制技术做到透明

![image-20211209185822492](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209185822.png)



 



### （2）数据库镜像

![image-20211209190205184](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209190205.png)

> 定义



![image-20211209190216922](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209190217.png)

> 数据库镜像的用途



![image-20211209190239349](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209190239.png)



![image-20211209190312889](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209190313.png)



![image-20211209190329738](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211209190330.png)









