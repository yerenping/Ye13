

![image-20211128160724973](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211128165255.png)



# 01-数据库基础概念



## 1、信息

信息是客观存在的，是关于现实世界具体事物的存在方式或运动状态的反应的综合

例如：宜春学院的学生	



### 2、数据

数据是信息在计算机里的表示，是信息的具体表现形式

例如：计算机中的一张二维表



### 3、 数据与信息的联系

数据是信息的符号表示或载体

信息则是数据的内涵，对数据的语意解释





## 4、数据库

DataBase：**长期存储**在计算机内，**有组织的**，**可共享的**数据集合。



## 5、数据库管理系统

一种能对数据库进行管理的系统软件，介于用户与OS之间。



## 6、数据库系统

1、数据库

2、数据用户（数据库管理员DBA、普通用户）

3、计算机软件、硬件（数据库管理系统、应用开发系统 、应用系统）

![](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211229201653.png)

## 7、数据库系统的体系结构

### （1）三层模式



**1、逻辑模式（1个）**

**2、外模式/子模式(多个外模式)**

**3、内模式（1个）**

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211128170034.png" alt="image-20211128170034920" style="zoom:50%;" /> 



### （2）两级映像

**1、外模式-逻辑模式映像**

有多少个外模式，就有多少个`外模式-逻辑模式映像`

**2、逻辑模式-内模式映像**





<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211128170102.png" alt="image-20211128170102396" style="zoom:50%;" />   



### （3）数据的独立性

定义：**外部的应用程序**和**数据**之间互相独立

①逻辑独立性：**DB与应用程序之间的互相独立性**

②物理独立性：**在DB一改变时，尽量不影响到应用程序**









## 8、数据模型

![image-20211128171413770](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211128171413.png) 



> 数据模型的三要素

1、数据结构：用于描述静态特征

2、数据操作：用于描述动态特征

3、数据完整性约束：是一组完整性规则的集合





> 数据模型的分类

1、关系模型

2、半结构化的的数据模型

- 网状数据库
- 层次模型
- XML
- JSON

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211128171649.png" alt="image-20211128171649783" style="zoom:50%;" /> 



## 9、数据库技术的产生和发展

（1）数据管理技术的发展阶段

（2）文件系统管理阶段

（3）数据性系统阶段





# 02-关系数据模型



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129153449.png" alt="image-20211129153449535" style="zoom:40%;" /> 

 

**（1）关系数据库系统**

> **关系数据库系统就是支持关系模型的数据库系统**
>
> 1970年IBM公司E.F.Codd提出的关数据模型
>
> 之后又提出：关系代数与关系演算的概念
>
> 1972提出了第一、第二、第三范式



**（2）关系模型的三要数**

1、关系的数据结构——一张二维表

![image-20211128172838751](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211128172838.png)

2、关系的操作

3、关系的完整性约束





## 1、数据结构

一张二维表

![image-20211128172838751](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211128172915.png) 

> 相关概念：

#### ①域

一种具有相同数据类型的值的集合

例如：整数的集合	{男，女} 

性别这一列

![image-20211128173204443](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211128173204.png)  



#### ②笛卡尔积（Cartesian Product）

![image-20211128173330539](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211128173330.png)



![image-20211128173456437](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211128173456.png)



==注：==

==分量：元祖中的一部分==

==元祖：一条信息==

![image-20211128173616129](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211128173616.png)



#### ③关系



![image-20211128173754006](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211128173754.png)

**==元祖（行）：3==**

**==属性（列）：3==**

**==域：表中的每一列对应一个域，故也为3==**



> 码（key，建）

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211128174059.png" alt="image-20211128174059064" style="zoom:33%;" /> 

**1、候选码**

在关系中能够唯一表示元祖的属性或属性集

例如上表中的：属性-学号

**2、主属性**

候选码的各个属性（可能存在多个）

例如**选课表SC(S#,C#,SCORE)**中，候选码为**（S#,C#）** , 主属性为：**S#**与**C#**



**3、主码**

用户选择元祖标识的候选键

==**注：当候选码只有一个的时候，主码 ==候选码 == 主属性**==



**4、全码**

关系中所有的属性都是候选码



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211128175115.png" alt="image-20211128175115012" style="zoom:67%;" /> 

==**问题：这两个关系的候选码是什么呢？**==

The relation Accounts ：acctNo

The relation Customers：idNo + account





#### ④关系模式

关系模式是对关系的描述

关系模式是**型**，关系是**值**

- 关系模式-学生关系

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129143049.png" alt="image-20211129143049113" style="zoom:50%;" /> 





#### ⑤关系数据库

![image-20211129144200932](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129144200.png)



 

## 2、关系操作



![image-20211129144732955](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129144733.png)



## 3、关系的完整性约束

> 定义：关系模型的完整性是指对关系的某种约束条件

**主要有三类：**

1、实体完整性

2、参照完整性

3、用户定义的完整性

**实体完整性**与参照完整性是关系模型必须满足的完整性约束条件



#### ① 实体完整性

1、**主码**唯一，且非空

2、**主属性**不能取空值



==**注：主属性是候选码（主码）的各个属性，主码是由多个主属性组成的**==

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129145512.png" alt="image-20211129145512831" style="zoom:50%;" /> 

 

==在SC成绩表中，主码：SID与CID的组合，主属性：有2个，分别为SID,CID==





 

#### ② 参照完整性

**1、关系间的引用**

![image-20211129150335461](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129150335.png)

![image-20211129150516695](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129150516.png)



2、外码

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129152032.png" alt="image-20211129152032825" style="zoom:67%;" />

3、参照完整性规则（规定外码）



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129152140.png" alt="image-20211129152140457" style="zoom:67%;" />



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129152415.png" alt="image-20211129152415622" style="zoom:67%;" />



#### ③ 用户定义的完整性

![image-20211129152539124](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129152539.png)  



![image-20211129152606207](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129152606.png)





# 03-关系数据库语言



![image-20211129153835133](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129153835.png)



![image-20211129154015856](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129154015.png)



## 1、关系代数

> 什么是关系代数？

是一种抽象的数据查询语言

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129154206.png" alt="image-20211129154206572" style="zoom:33%;" /> 

- 运算对象：关系
- 运算符：4类
- 运算结果：关系

 

> 运算法

![image-20211129154429385](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129154429.png) 







### 1、投影



![image-20211129163633480](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129163633.png)

​	

例题 

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129163929.png" alt="image-20211129163929070" style="zoom:67%;" /> 



![image-20211129164038633](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129164038.png)





### 2、选择

![image-20211129164203038](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129164203.png)



例题

![image-20211129164429629](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129164429.png)



![image-20211129164650651](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129164650.png)



![image-20211129164819177](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129164819.png)



其他方式解题

![image-20211129165044971](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129165045.png)



**综合应用**

> 投影+选择解决问题
>
> 操作：一般是先选择，后投影（先行后列）



![image-20211129165236979](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129165343.png)

### 3、笛卡尔积（关系 × 关系）

![image-20211129165626323](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129165626.png)



例题

![image-20211129165729325](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129165729.png)





### 4、连接

![image-20211129165916422](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129165922.png)

等同于↓

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129165841.png" alt="image-20211129165841277" style="zoom:50%;" /> 



**例题：**

![image-20211129170116147](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129170116.png)





#### ① 等值连接

![image-20211129170231066](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129170231.png)



**例题**

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129170342.png" alt="image-20211129170342386" style="zoom:67%;" /> 



例题2（等值连接）



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129171208.png" alt="image-20211129170913876" style="zoom:50%;" /> 



#### ② 自然连接

![image-20211129170450296](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129170450.png)



例题1

![image-20211129171140709](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129171140.png)

==注：自然连接实际上就是在**等值连接**的基础上，去掉**公共属性重复的列**。==





![image-20211129171421127](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129171421.png)



==注：这道题中有两个公共属性，所以必须满足两个公共属性都相等，需要去掉两列。==









#### 综合例子

> 例表

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129171628.png" alt="image-20211129171628610" style="zoom:50%;" /> 



![image-20211129173113999](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129173114.png) 

==**注意：先做连接会影响效率，因此应该先做选择，再做查询**==



![image-20211129173907733](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129173907.png)

**分析：**

1、先选择出名字=LIU的老师（也许只有一个教师LIU）

2、在去跟其他表做自然连接（提升效率）



TID –> CID –> SID –> 学号和姓名，涉及所有表



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129174454.png" alt="image-20211129174454741" style="zoom:67%;" /> 



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129174540.png" alt="image-20211129174540889" style="zoom:67%;" />  

> 正确解法

![image-20211129174929016](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129174929.png)



![image-20211129175209963](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129175210.png)







### 5、重命名

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129175504.png" alt="image-20211129175504516" style="zoom:50%;" />  



> 例子



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129175351.png" alt="image-20211129175351078" style="zoom:30%;" /> 

 





### 6、一些等价的操作

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129175703.png" alt="image-20211129175703748" style="zoom:33%;" /> 





### 7、运算符的优先级

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211129175748.png" alt="image-20211129175748086" style="zoom:50%;" /> 

 



### 8、表达式树





![image-20211206083437496](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206083437.png)





![image-20211206083549997](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206083550.png)







![image-20211206083658028](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206083658.png)



## 2、SQL语言



> 本章概述



![image-20211206083753647](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206083753.png)





## （1）SQL概述

> SQL概述



![image-20211206083835694](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206083835.png)



> sql标准

![image-20211206083956891](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206083956.png)





> SQL的特点

1. 综合统一

- DDL 数据定义语言
- DML 数据操作语言
- DCL 数据控制语言

2. 高度非过程化

- 用于只需指明“做什么”，而不必指明“怎么做”
- 存取路径的选择及SQL语句的操作过程由系统自动完成

3. 面向集合的操作方式

- 操作对象、查找结果可以是元组的集合
- 一次插入、删除、更新操作的对象可以是元组的集合

4. 同一种语法提供两种使用方式

- 嵌入式
- 自含式

5. 语言简洁，易学易用



> 3大类11个命令词



![image-20211206084630824](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206084630.png)



> SQL支持的三级模式结构



（外模式-视图view、模式-基本表、内模式-存储文件）

![image-20211206084754518](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206084754.png)







> SQL语言的基本概念

![image-20211206090638092](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206090638.png)



## （2）SQL数据定义（DDL）

### 1、Sql数据定义功能

![image-20211206090823427](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206090823.png)



### 2、定义、删除与修改基本表

![image-20211206091002972](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206091003.png)



#### ①、定义基本表

> 定义基本表



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206091241.png" alt="image-20211206091241597" style="zoom:50%;" /> 



> 定义表的基本格式

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206091316.png" alt="image-20211206091316314" style="zoom:50%;" /> 



`char`：固定长度字符  

例如char(8)，如果只使用了7字符，第8个字符系统会留着

`varchar`：可表长度字符

例如char(20)，如果只使用了2字符，后18个字符系统会分配给其它变量用



> 表级完整性约束及列级完整性约束

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206092842.png" alt="image-20211206092842602" style="zoom:50%;" /> 



> SQL支持的数据类型

**第一大类：==整数==数据**

![image-20211206092922382](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206092922.png)



**第二大类：==精确数值==数据**

![image-20211206093135346](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206093135.png) 



**第三大类：==浮点==数值数据**

![image-20211206094004747](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206094004.png)



**第四大类：==字符串==数据**

![image-20211206094042269](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206094042.png) 



**第五大类：==日期时间==数据**

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206094153.png" alt="image-20211206094153385" style="zoom:50%;" /> 



> 例题



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206121455.png" alt="image-20211206121455408" style="zoom:50%;" /> 

==注意：primary key 与unique的区别==

==1、一个表必须有主键，而且仅能有一个主键，而unique可以定义多个==

==2、主键不能为空，而unique可以为空==



> 例题2



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206130626.png" alt="image-20211206130626169" style="zoom:50%;" /> 

==注：标记完整性约束的方式进行定义-`primary key(sno,cno)`==



#### ②、修改基本表

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206133809.png" alt="image-20211206133809079" style="zoom:50%;" /> 



![image-20211206133846850](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206133846.png)



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206133959.png" alt="image-20211206133959872" style="zoom:50%;" /> 





#### ③、删除基本表

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206134207.png" alt="image-20211206134207655" style="zoom:50%;" /> 





## （3）SELECT查询语句（DML）

> 查询语句格式

 

![image-20211206141428840](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206141428.png)



> 示例数据库

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206141532.png" alt="image-20211206141532253" style="zoom:50%;" /> 



### 1、单表查询

![image-20211206183627635](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206183627.png)



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206141720.png" alt="image-20211206141720882" style="zoom:50%;" /> 



#### ①、选择表当中的若干列

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206141908.png" alt="image-20211206141908251" style="zoom:33%;" /> 



> 查询指定的列

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206141941.png" alt="image-20211206141941537" style="zoom:50%;" /> 



> 例题

![image-20211206142217633](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206142217.png) 



```sql


1、查询全体学生的学号与姓名


select sno,sname from Student;


2、全体学生的姓名、学号、所在系


select sno,sname,dept from Stduent;




3、查询全体学生的姓名及出生年份


select sname,year(getdate()-age) as '出生年月' from student; // A as B 给A取别名为B




4、查询全体学生的姓名，出生年份和所在系，要求用小写字母表示所有名称

select sname NAME,year(getdate()) as 'BIRTH' lower(Sdept) department from student; // lower 大写->小写



```





<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206142850.png" alt="image-20211206142850823" style="zoom:50%;" /> 



#### ②、选择表中若干元组



```sql
1、查询选修了课程的学生学号
select sno from score; // 查询结果会有重复

-- 改进 --
select distinct sno from score; // distinct 去重复

```



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206144451.png" alt="image-20211206144451474" style="zoom:33%;" />

 



> 查询满足条件的元祖

![image-20211206144556662](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206144556.png)



##### 1. 比较大小

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206144651.png" alt="image-20211206144651244" style="zoom: 33%;" /> 





<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206144736.png" alt="image-20211206144736588" style="zoom:50%;" /> 





<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206144806.png" alt="image-20211206144806302" style="zoom:33%;" /> 





##### **2. 确定范围**

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206145441.png" alt="image-20211206145441141" style="zoom:33%;" /> 



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206145624.png" alt="image-20211206145608354" style="zoom:50%;" /> 





##### **3. 确定集合**

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206145719.png" alt="image-20211206145719714" style="zoom:50%;" /> 

 

例题

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206145746.png" alt="image-20211206145746138" style="zoom:50%;" /> 

或者

```sql
select * from sname,sex from stdudent
where sdept = 'is' or sdept = 'ma' or sdept= 'cs';
```





<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206145819.png" alt="image-20211206145819079" style="zoom:50%;" /> 





或者

```sql
select * from sname,sex from stdudent
where sdept != 'is' and sdept != 'ma' and sdept != 'cs';
```





##### 4. 字符串匹配运算法

![image-20211206150102063](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206150102.png)







![image-20211206150155784](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206150155.png)



**通配符**

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206150222.png" alt="image-20211206150221950" style="zoom:50%;" />



**%号：多个字符**

![image-20211206150255410](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206150255.png)



**“_”单个字符**



![image-20211206150338996](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206150339.png)



![image-20211206150515833](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206150515.png)



![image-20211206150607918](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206150608.png)



##### 5. 涉及空值的查询

![image-20211206150810223](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206150810.png)





<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206151056.png" alt="image-20211206151056125" style="zoom:50%;" />



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206151119.png" alt="image-20211206151119071" style="zoom:50%;" /> 





##### 6.多重条件查询

![image-20211206151210929](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206151211.png)



1、查询信息系（IS）,数学系（MA）和计算机科学系（CS）的学生学号与性别

```sql
select * from sname,sex from stdudent
where sdept = 'is' or sdept = 'ma' or sdept= 'cs';

select * from sname,sex from stdudent
where sdept in ('is','ma','cs'); // 等价于上面的方式
```



#### ③、对查询结果进行排序

![image-20211206151547326](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206151547.png)



例题：

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206151633.png" alt="image-20211206151633467" style="zoom:50%;" /> 



![image-20211206151737860](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206151737.png) 



#### ④、使用集函数

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206151809.png" alt="image-20211206151809491" style="zoom:33%;" /> 

==注：==
==1、上述集函数不会统计null值==

==2、count(*) 统计行数==

==3、列名前面都能加distinct，则统计去掉重复行==



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206171425.png" alt="image-20211206171424952" style="zoom:50%;" /> 



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206171524.png" alt="image-20211206171524088" style="zoom:50%;" /> 

 

 



#### ⑤、对查询结果分组



##### 1、GROUP BY

![image-20211206171616990](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206171617.png)



> 求各个课程号及相应的选课人数

```sql
select cno,count(sno) from score by cno
```

> 统计一下各个课程的选修人数以及各个课程的最高分

```sql
select cno,count(sno),max(grade) from score group by cno
```

==-- 分析语句 --==
==1、先执行group by cno,按照课程号进行分组==
==2、分组之后的每一组应用count、max等聚合函数==



**==注意：==**

**==当一个select语句中含有group by子句的话，select语句中只能包含两种情况：==**

**==（1）、group by后面的列名==**

**==（2）、聚合函数==**





例题：

> 求各个课程号及相应的课程成绩在90分以上的学生人数

```sql
-- 分析 --
1、求各个课程号
2、课程成绩在90分以上的人数

select cno count(sno) from score 
where grade>=90
group by cno
```



> 系统内部执行的顺序

![image-20211206181959777](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206181959.png)



##### 2、HAVING



![image-20211206182133203](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206182133.png)



![image-20211206182153450](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206182153.png)



![image-20211206182352482](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206182352.png)



**==注意：==**

**==HAVING 后面可以跟列名，也可以跟聚合函数==**

**==WHERE 后面不可以跟聚合函数，可以跟列名==**



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211206182730.png" alt="image-20211206182730776" style="zoom:50%;" /> 





















































# 04-数据库规范化理论



1、函数依赖

2、范式

2、关系规范化

















# 07- 数据库管理

> 章节脑图



![image-20211202183005397](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202183005.png)



## 1、安全性

<img src="/Users/ouyangyansong/Library/Application%20Support/typora-user-images/image-20211130103333543.png" alt="image-20211130103333543" style="zoom:50%;" />  



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211130103417.png" alt="image-20211130103417087" style="zoom:50%;" /> 



==**用户非法使用数据库的情况**==

![image-20211130103535099](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211130103535.png)



> 计算机系统中常用的安全模型



![image-20211130103631578](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211130103631.png)



### 1.1 安全性控制的一般方法

（1）用户标识和鉴定

比如：qq登录，需要用户名和密码



（2）存取控制

（3）视图

（4）审计

（5）密码存储





### 1.2 SQL的DCL实现存取权限管理

![image-20211202085246383](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202085246.png) 





### 1.3 并发控制



![image-20211202085648549](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202085648.png)



#### 3.1 并发控制概述

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202085805.png" alt="image-20211202085805226" style="zoom:50%;" /> 



==**事务**==是并发控制和恢复的基本单位



##### **（1）、事务**

![image-20211202090008710](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202090008.png)



> 事务的定义

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202090059.png" alt="image-20211202090059386" style="zoom:50%;" /> 



> 事务的两种定义方式

![image-20211202090142471](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202090142.png)



**事务的显示定义**

![image-20211202090222749](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202090222.png)



> COMMIT 与ROLLBACK



![image-20211202090256823](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202090256.png)



> 事务的四个特性



![image-20211202090359288](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202090359.png)



- **原子性**

![image-20211202090439542](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202090439.png)

- **一致性**

![image-20211202090536428](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202090536.png)



![image-20211202090624431](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202090624.png)



- **隔离性**

![image-20211202091336734](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202091336.png)



- **持久性**

![image-20211202091354721](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202091354.png)



> 破坏事务的特性

![image-20211202091515754](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202091515.png)





> 多事务执行方式



![image-20211202091622589](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202091622.png)





> 事务并发执行带来的问题

![image-20211202091726659](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202091726.png)





##### （2）、数据的不一致性问题

###### 1、丢失修改

![image-20211202091924137](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202091924.png)



###### 2、不可重复度

- **读-更新**

![image-20211202092241873](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202092241.png)

![image-20211202092148071](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202092148.png)

- **读-删除**

![image-20211202092258949](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202092259.png)



- **读-插入**

![image-20211202092320125](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202092320.png)



注：第二种与第三种现象也称为`幻行现象`





###### 3、读脏数据

![image-20211202092440170](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202092440.png)



#### 3.2 并发操作的调度

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202092603.png" alt="image-20211202092603168" style="zoom:33%;" /> 





<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202092633.png" alt="image-20211202092632947" style="zoom:33%;" /> 





<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202092731.png" alt="image-20211202092731702" style="zoom:33%;" /> 





> a、串行调度策略 -正确



<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202092747.png" alt="image-20211202092747102" style="zoom:33%;" /> 





> B、串行调度策略 -正确

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202092848.png" alt="image-20211202092848873" style="zoom: 33%;" /> 





> c、不可串行

<img src="/Users/ouyangyansong/Library/Application%20Support/typora-user-images/image-20211202144215919.png" alt="image-20211202144215919" style="zoom:33%;" /> 



 

#### 3.3 封锁

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202150418.png" alt="image-20211202150418561" style="zoom:53%;" /> 



> 封锁的定义



![image-20211202150537114](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202150537.png)

##### 3.1.1 封锁的类型

###### 1、排它锁（eXclusive lock，简称X锁，写锁）

<img src="/Users/ouyangyansong/Library/Application%20Support/typora-user-images/image-20211202150959806.png" alt="image-20211202150959806" style="zoom:50%;" /> 













###### 2、共享锁（Share lock，简称S锁，读锁）



![image-20211202151336866](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202151336.png)



###### 3、封锁类型的相容性

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202151445.png" alt="image-20211202151445794" style="zoom:50%;" /> 



###### 4、封锁的粒度

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202151545.png" alt="image-20211202151545848" style="zoom:67%;" /> 



![image-20211202151609331](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202151609.png)



![image-20211202151653823](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202151653.png)



> 封锁的一般原则

![image-20211202151736086](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202151736.png)

 



###### 5、封锁协议

![image-20211202151823229](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202151823.png)





###### 6、三级封锁协议



**一级封锁协议：**

<img src="/Users/ouyangyansong/Library/Application%20Support/typora-user-images/image-20211202152004830.png" alt="image-20211202152004830" style="zoom:50%;" /> 

==注：一级封锁协议只规定了写（更新）之前要加X锁，并没有规定读之前要加锁==





> 一级封锁： 解决了丢失更新问题

![image-20211202152339259](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202152339.png) 







> 一级封锁： 没能解决“读脏数据”问题

![image-20211202152624561](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202152717.png)



> 一级封锁： 没能解决 不可重复读问题

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202152922.png" alt="image-20211202152922836" style="zoom:50%;" /> 





**二级封锁协议：**

![image-20211202153350025](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202153350.png)



> 二级封锁协议-解决–“不读脏数据问题”

![image-20211202153526642](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202153526.png)





> 二级封锁协议-不能解决–“不可重复读问题”

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202154027.png" alt="image-20211202154027734" style="zoom:50%;" /> 



**三级封锁协议：**

![image-20211202175545389](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202175609.png)



> 三级封锁协议-解决了不可重复度的问题

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202175937.png" alt="image-20211202175937018" style="zoom:67%;" /> 



> 三级封锁协议总结

![image-20211202180208424](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202180208.png)





###### 7、两段锁协议

![image-20211202181113320](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202181113.png)





> 例子

<img src="https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202181245.png" alt="image-20211202181245293" style="zoom:50%;" /> 



![image-20211202181443562](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202181443.png) 







#### 3.4 活锁

![image-20211202182019728](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202182019.png)



> 如何避免活锁

![image-20211202182132076](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202182132.png)





#### 3.5 死锁

![image-20211202182207284](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202182207.png)



> 解决死锁方法



**1、死锁的预防**

![image-20211202182332404](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202182332.png)



![image-20211202182525903](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202182525.png)



![image-20211202182545359](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202182545.png)



> 循序封锁法存在的问题



![image-20211202182600697](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202182600.png)





**2、死锁的诊断与解除**

![image-20211202182654381](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202182654.png)



![image-20211202182920979](https://yerenping.oss-cn-beijing.aliyuncs.com/img/20211202182921.png)









